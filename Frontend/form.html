<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>  
        body{  
          font-family: Calibri, Helvetica, sans-serif;  
          background-color: orange;  
        }  
        .container { 
            margin: 150px; 
            margin-top: 30px;
            padding: 50px;  
            background-color: white;  
        } 
          
        input[type=text] {  
          width: 100%;  
          padding: 15px;  
          margin: 5px 0 22px 0;  
          display: inline-block;  
          border: none;  
          background: #f1f1f1;  
        }  
        input[type=text]:focus {  
          background-color:none;  
          outline: none;  
        }  

        input[type=email] {  
          width: 100%;  
          padding: 15px;  
          margin: 5px 0 22px 0;  
          display: inline-block;  
          border: none;  
          background: #f1f1f1;  
        }  
        input[type=email]:focus {  
          background-color:none;  
          outline: none;  
        }  

         div {  
                    padding: 10px 0;  
                 }  
        hr {  
          border: 1px solid #f1f1f1;  
          margin-bottom: 25px;  
        }  
        #new-detail-input {  
          background-color: darkgray;  
          color: white;  
          padding: 16px 20px;  
          margin: 8px 0;  
          border: none;  
          cursor: pointer;  
          width: 100%;  
          opacity: 0.9;  
        }  
        #new-detail-input:hover {  
          opacity: 1;  
        }  
        </style> 
</head>
<body>
  
    <form name="form" method="POST" action="" class="input" id="form">  
      
        <div class="container"> 
          <div class="image">
            <img src="./side-logo.png" width=300px height=100px>
          </div>

        <h1>Sign up for Code Queen Kampala</h1>  
        <p>We are excited to see you interested. Submit your application here - we can't wait to read it. The name and photo associated with your Google account will be recorded when you upload files and submit this form.</p>
        <hr>  

        <label for="email"><b>Email:</b></label>  
        <input type="email" placeholder="Your answer" name="email" id="email" required> <br> <br>

        <label> <b>Firstname:</b> </label>   
        <input type="text" id="firstName" name="firstname" placeholder= "Your answer" size="15" required />   
          
        <label> <b>Lastname:</b> </label>    
        <input type="text" id="lastName" name="lastname" placeholder="Your answer" size="15"required />   

        <label> <b>Phone number (WhatsApp number):</b> </label>     
        <input type="text" id="phoneNumber" name="phone" placeholder="Your answer" size="10" required />

        <label> <b>Date of birth:</b> </label>    
        <input type="date" id="dob" name="" size="15"required /> <br> <br>

        <label> <b>Which city are you from?</b> </label>  <br>   
        <input type="text" id="city" name="" placeholder="Your answer" size="10" />

        <label><b>What is your status?</b></label>  
          <select id="status">  
            <option value="married">Married</option>  
            <option value="single">Single</option>  
            <option value="divorced">Divorced</option>  
            <option value="separated">Separated</option>  
            <option value="singleparent">Single parent</option>  
          </select>  <br> <br>
      
        <label><b>Do you have any children?</b></label><br>  
        <input type="radio" id="yes" value="yes" name="children" > Yes   
        <input type="radio" id="no" value="no" name="children"> No  <br> <br> 
       
        <label><b>If yes, how many?</b></label>   
        <input type="text" id="number_of_children"name="" placeholder= "Your answer" size="15" required />
         
        <label><b>What is your highest level of education?</b></label>  
          <select id="education">  
            <option value="university">University graduate</option>  
            <option value="alevel">A-Level</option>  
            <option value="olevel">O-Level</option>  
            <option value="primary">Primary</option>  
            <option value="other">Other</option>  
          </select>  <br> <br> <br>
 
        <label><b>What is your current occupation?</b></label>  
          <select id="occupation">  
            <option value="employed">Employed</option>  
            <option value="unemployed">Unemployed</option>  
            <option value="student">Student</option>  
            <option value="stayhome">Stay home parent</option>  
          </select>  <br> <br> <br>
 
        <label><b>What is your monthly income (UGX)?</b></label>  
          <select id="income">  
            <option value="none">Don't have an income yet</option>  
            <option value="200k">less than 200k</option>  
            <option value="between">between 200k and 600k</option>  
            <option value="600k">more than 600k</option>  
          </select>  <br> <br>

        <label><b>Do you have a laptop?</b></label><br>  
        <input type="radio" id="laptop" value="yes" name="laptop" > Yes   
        <input type="radio" id="no_laptop" value="no" name="laptop"> No   <br> <br>
         
        <label><b>Do you have access to data bundles or wifi?</b></label><br>  
        <input type="radio" id="wifi" value="yes" name="data" > Yes   
        <input type="radio" id="no_wifi" value="no" name="data"> No   <br> <br>
        
        <label><b>If No, How will you manage to continue with the program Online(for 2 hours classes, 3 times a week for 2 months)? NB: 80% attendance is required for graduation</b></label>   
        <input type="text" id="classes" name="classes" placeholder= "Your answer" size="15" required /> <br> 
 
        <label><b>How did you hear about this opportunity?</b></label> 
          <select id="opportunity">  
            <option value="facebook">Facebook</option>  
            <option value="whatsapp">WhatsApp</option>  
            <option value="website">Website</option>  
            <option value="linkedin">LinkedIn</option>  
            <option value="mouth">Word of mouth</option>  
          </select>  <br> <br>

        <label> <b>Which Facebook group, Website, WhatsApp group or other channels?</b> </label>  <br>   
        <input type="text" id="media" name="media" placeholder="Your answer" size="10" />
 
        <label><b>Why do you want to sign up for this course?</b></label>  
          <select id="why_this_course" >  
            <option value="facebook">I'm looking for a career change in technology</option>  
            <option value="whatsapp">I want to up-skill for my existing employer</option>  
            <option value="website">I want to improve my coding skills for fun</option>  
            <option value="mouth">I am not sure - I just want to see where this takes me</option>  
          </select>  <br> <br> 

        <input type="checkbox" id="permission"><label><b>Please check this box to give ETC permission to contact you and also process and store your data for reports</b></label><br> <br>
        
        <input id="new-detail-input" type="submit" value="Submit">  
      </form> 

      <script>
        let details = [];

$("#new-detail-input").click(function() {
  const email = $("#email").val();
  const firstName = $("#firstName").val();
  const lastName = $("#lastName").val();
  const phoneNumber = $("#phoneNumber").val();
  const dob = $("#dob").val();
  const city = $("#city").val();
  const status = $("#status").val();
  document.getElementsByName("children")[0].checked;
  document.getElementsByName("children")[1].checked;
  const number_of_children = $("#number_of_children").val();
  const education = $("#education").val();
  const occupation = $("#occupation").val();
  const income = $("#income").val();
  document.getElementsByName("laptop")[0].checked;
  document.getElementsByName("laptop")[1].checked;
  document.getElementsByName("data")[0].checked;
  document.getElementsByName("data")[1].checked;
  const classes = $("#classes").val();
  const opportunity = $("#opportunity").val();
  const media = $("#media").val();
  const why_this_course = $("#why_this_course").val();
  const permission = $("#permission").val();

  const data = {
    email,
    firstName,
    lastName,
    phoneNumber,
    dob,
    city,
    status,
    yes,
    no,
    number_of_children,
    education,
    occupation,
    income,
    laptop,
    no_laptop,
    wifi,
    no_wifi,
    classes,
    opportunity,
    media,
    why_this_course,
    permission
  }
  console.log(data);

  $(document).ready(()=>{
    const display = $("#display");
    const form = $("#form");
    const details = $("#details");

    const getApplications = ()=>{
    fetch('/getApplications',{method : "get"}).then((response)=>{
      return response.json();
    }).then((data)=>{
      console.log(data);
      displayApplications(data);
    });
  }

  getApplications();

    const resetApplicationsInput = ()=>{
    detail.val('');
  }

  const editApplication = (application,applicationID,editID)=>{
    let editBtn = $('${editID}');
    editBtn.click(()=>{
      fetch('/$application._id}', {
        method : "put",
        headers : {
          "Content-Type" : "application/json"
        },
        body : JSON.stringify({application : detail.val()})
      }).then((response)=>{
        return response.json();
      }).then((data)=>{
        if(data.ok == 1){
          let applicatonIndex = $('#${applicaionID}');
          applicaionIndex.html(data.value.application);
          resetApplicationsInput();
        }
      })
    })
  }

  const deleteApplication = (application,listItemID,deleteID)=>{
    let deleteBtn = $('#${deleteID}');
    deleteBtn.click(()=>{
      fetch('/${application._id}',{
        method : "delete"
      }).then(()=>{
        return response.json();
      }).then((data)=>{
        if(data.ok == 1){
          $('#${listItemID}').remove();
        }
      });
    })
  }

    const buildIDS = (application)=>{
    return {
      editID : "edit_" + todo._id,
      deleteID : "delete_" + todo._id,
      applicationID : "todo_" + todo._id
    }
  }

  const displayApplications = (data)=>{
    data.forEach((application)=>{
      let ids = buildIDS(application);
    });
  }

  form.submit((e)=>{
    e.preventDefault();
    fetch('/', {
      method : 'post',
      body : JSON.stringify(),
      headers : {
        "Content-Type" : "application/json",
      }
    }).then((response)=>{
      return response.json();
    }).then((data)=>{
      if(data.result.ok ==1 && data.result.n ==1){
        let ids = buildIDS(data.document);
        display.append(buildTemplate(data.document,ids));
        editApplication(data.document,ids.applicationID,ids.editID);
      }
      resetApplicationsInput();
    });
  });
      </script>

      
</body>
</html>